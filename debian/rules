#!/usr/bin/make -f
# You must remove unused comment lines for the released package.
# See debhelper(7) (uncomment to enable)
# This is an autogenerated template for debian/rules.
#
# Output every command that modifies files on the build system.
export DH_VERBOSE = 1
#
# Copy some variable definitions from pkg-info.mk and vendor.mk
# under /usr/share/dpkg/ to here if they are useful.
#
# See FEATURE AREAS/ENVIRONMENT in dpkg-buildflags(1)
# Apply all hardening options
#export DEB_BUILD_MAINT_OPTIONS = hardening=+all
# Package maintainers to append CFLAGS
#export DEB_CFLAGS_MAINT_APPEND  = -Wall -pedantic
# Package maintainers to append LDFLAGS
#export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed
#
# With debhelper version 9 or newer, the dh command exports
# all buildflags.  So there is no need to include the
# /usr/share/dpkg/buildflags.mk file here if compat is 9 or newer.
#
# These are rarely used code. (START)
#
# The following include for *.mk magically sets miscellaneous
# variables while honoring existing values of pertinent
# environment variables:
#
# Architecture-related variables such as DEB_TARGET_MULTIARCH:
#include /usr/share/dpkg/architecture.mk
# Vendor-related variables such as DEB_VENDOR:
#include /usr/share/dpkg/vendor.mk
# Package-related variables such as DEB_DISTRIBUTION
#include /usr/share/dpkg/pkg-info.mk
#
# You may alternatively set them susing a simple script such as:
# DEB_VENDOR ?= $(shell dpkg-vendor --query  Vendor)
#
# These are rarely used code. (END)
#
include /usr/share/dpkg/default.mk
DEB_BUILD_ARCH ?= $(shell dpkg-architecture -qDEB_BUILD_ARCH)
DEB_HOST_MULTIARCH ?= $(shell dpkg-architecture -qDEB_HOST_MULTIARCH)

export QT_SELECT=qt5

# main packaging script based on post dh7 syntax
%:
	dh $@
override_dh_auto_clean:
	rm -rf $(CURDIR)/build-$(DEB_HOST_MULTIARCH)

override_dh_auto_configure:
	mkdir -p $(CURDIR)/build-$(DEB_HOST_MULTIARCH)

	qmake BUILD_VERSION=$(DEB_VERSION_UPSTREAM) $(CURDIR)/gxde-requ.pro \
	-o $(CURDIR)/build-$(DEB_HOST_MULTIARCH)/
override_dh_auto_build:
	make -C $(CURDIR)/build-$(DEB_HOST_MULTIARCH) -j$(JOBS)
override_dh_auto_install:
	make -C $(CURDIR)/build-$(DEB_HOST_MULTIARCH) install \
	INSTALL_ROOT=$(CURDIR)/debian/gxde-requ
	mkdir -p $(CURDIR)/debian/gxde-requ/usr/share/gxde-k9/edging
	mkdir -p $(CURDIR)/debian/gxde-requ/usr/libexec/gxde-requ/bin/
	install $(CURDIR)/k9/gxde-requ.edging $(CURDIR)/debian/gxde-requ/usr/share/gxde-k9/edging
	install $(CURDIR)/bin/gxde-requ-setter $(CURDIR)/debian/gxde-requ/usr/bin/
	install $(CURDIR)/libexec/close_window $(CURDIR)/debian/gxde-requ/usr/libexec/gxde-requ/bin/

# debmake generated override targets
# Multiarch package requires library files to be installed to
# /usr/lib/<triplet>/ .  If the build system does not support
# $(DEB_HOST_MULTIARCH), you may need to override some targets such as
# dh_auto_configure or dh_auto_install to use $(DEB_HOST_MULTIARCH) .
